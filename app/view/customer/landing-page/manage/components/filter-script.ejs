<script defer>
	function renderLeads(leads, setup) {
		const filter_div = document.getElementById("leadlp-filter-div");
    filter_div.innerHTML = "";

    for(let i = setup.page * setup.pageSize; i < leads.length && i < (setup.page + 1) * setup.pageSize; i++){
      let lead_div = lib.element.create("div", { class: "box b1 container border radius-5 padding-5 margin-top-5" });
      lead_div.append(lib.element.create("div", { class: "box b8 em09 border radius-5 padding-5 center" }, leads[i].id));
      lead_div.append(lib.element.create("div", { class: "box b2 em09 padding-5 center" }, leads[i].name));
      lead_div.append(lib.element.create("div", { class: "box b3-8 em09 padding-5 center" }, leads[i].email));
      lead_div.append(lib.element.create("div", { class: "box b3-8 em09 padding-5 center" }, leads[i].phone));
      lead_div.append(lib.element.create("div", { class: "box b2 em09 padding-5 center" }, leads[i].status));
      leads[i].user_id && lead_div.append(lib.element.create("div", { class: "box b8 lucida-grande em08 bold border-lg-st radius-5 padding-5 center pointer" }, leads[i].user_id));
      !leads[i].user_id && lead_div.append(lib.element.create("div", { 
        class: "box b8 lucida-grande em08 bold border-lg-st radius-5 padding-5 center pointer"
      }, "Atender"));
      filter_div.append(lead_div);
		}
	};

  document.getElementById("leadlp-filter-form").addEventListener("submit", async e => {
    e.preventDefault();

    let lead = {
      name: e.target.elements.namedItem("name").value,
      email: e.target.elements.namedItem("email").value,
      periodStart: lib.dateToTimestamp(event.target.elements.namedItem("periodStart").value),
      periodEnd: lib.dateToTimestamp(event.target.elements.namedItem("periodEnd").value),
      status: e.target.elements.namedItem("status").value
    };

    let leads = await API.response(Customer.landingPage.filter, lead);
    if(!leads) { return false; }
    
    const setup = { pageSize: 20, page: 0 };
    (function(){ lib.carousel.execute("leadlp-filter-box", renderLeads, leads, setup); }());
  });
</script>