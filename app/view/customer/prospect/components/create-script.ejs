<script>
	document.getElementById("prospect-create-form").addEventListener("submit", async e => {
		e.preventDefault();

		const prospect = {
			brand: lib.capitalizeFirst(e.target.elements.namedItem("brand").value),
			state: e.target.elements.namedItem("state").value,
			phone: e.target.elements.namedItem("phone").value,
			social_media: e.target.elements.namedItem("social-media").value,
			product_approach: e.target.elements.namedItem("product-approach").value
		};

		let response = await API.response(Customer.prospect.save, prospect);
		if(!response) { return false; }

		e.target.elements.namedItem("brand").value = "";
		e.target.elements.namedItem("state").value = "";
		e.target.elements.namedItem("phone").value = "";
		e.target.elements.namedItem("social-media").value = "";
		e.target.elements.namedItem("product-approach").value = "";

		document.getElementById("prospect-filter-form").submit.click();
	});

	async function confirmContact1 (id) {
		let prospect = {
			id: id,
			name: document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('name').value,
			email: document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('mail').value,
			cellphone: document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('cellphone').value,
			comment: document.getElementById('prospect-form-'+id).getElementsByTagName('textarea').namedItem('comment').value,
			meeting: lib.datetimeToTimestamp(document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('meeting').value),
			status: document.getElementById('prospect-form-'+id).getElementsByTagName('select').namedItem('status').value
		};

		if(prospect.name && prospect.email && prospect.cellphone && prospect.status == "Contatar loja novamente"){
			let r = confirm("ATENÇÃO: \n\n Você já tem todas as informações para contatar o responsável, tem certeza que deseja contatar a loja novamente?");
			if(!r){ return; }
		}

		let response = await API.response(Customer.prospect.confirmContact1, prospect);
		if(!response) { return false; }

		document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('name').value = "";
		document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('mail').value = "";
		document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('cellphone').value = "";
		document.getElementById('prospect-form-'+id).getElementsByTagName('textarea').namedItem('comment').value = "";
		document.getElementById('prospect-form-'+id).getElementsByTagName('select').namedItem('status').value = "";

		document.getElementById("prospect-filter-form").submit.click();
	};

	async function confirmContact2 (id) {
		let prospect = {
			id: id,
			name: document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('name').value,
			email: document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('mail').value,
			cellphone: document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('cellphone').value,
			comment: document.getElementById('prospect-form-'+id).getElementsByTagName('textarea').namedItem('comment').value,
			meeting: lib.datetimeToTimestamp(document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('meeting').value),
			status: document.getElementById('prospect-form-'+id).getElementsByTagName('select').namedItem('status').value
		};

		if(prospect.name && prospect.email && prospect.cellphone && prospect.status == "Contatar loja novamente"){
			let r = confirm("ATENÇÃO: \n\n Você já tem todas as informações para contatar o responsável, tem certeza que deseja contatar a loja novamente?");
			if(!r){ return; }
		}

		let response = await API.response(Customer.prospect.confirmContact2, prospect);
		if(!response) { return false; }
		
		document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('name').value = "";
		document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('mail').value = "";
		document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('cellphone').value = "";
		document.getElementById('prospect-form-'+id).getElementsByTagName('textarea').namedItem('comment').value = "";
		document.getElementById('prospect-form-'+id).getElementsByTagName('select').namedItem('status').value = "";

		document.getElementById("prospect-filter-form").submit.click();
	};

	async function confirmContact3 (id) {
		let prospect = {
			id: id,
			email: document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('mail').value,
			comment: document.getElementById('prospect-form-'+id).getElementsByTagName('textarea').namedItem('comment').value,
			rating: document.getElementById('prospect-form-'+id).getElementsByTagName('select').namedItem('rating').value,
			status: document.getElementById('prospect-form-'+id).getElementsByTagName('select').namedItem('status').value
		};

		let response = await API.response(Customer.prospect.confirmContact3, prospect);
		if(!response) { return false; }
		
		document.getElementById('prospect-form-'+id).getElementsByTagName('input').namedItem('mail').value = "";
		document.getElementById('prospect-form-'+id).getElementsByTagName('textarea').namedItem('comment').value = "";
		document.getElementById('prospect-form-'+id).getElementsByTagName('select').namedItem('status').value = "";

		document.getElementById("prospect-filter-form").submit.click();
	};
</script>